<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶é•¿åä½œç©ºé—´ - AI Tutor</title>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <style>
        :root {
            --primary: #1E94F6;
            --secondary: #8B5CF6;
            --success: #22C55E;
            --warning: #F59E0B;
            --error: #EF4444;
            --bg: #F9FAFB;
            --text: #111827;
            --text-secondary: #6B7280;
            --school-selection: #3B82F6;
            --interview-prep: #8B5CF6;
            --experience: #22C55E;
            --other: #6B7280;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding-bottom: 70px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px 16px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Search Bar */
        .search-bar {
            background: white;
            padding: 12px 16px;
            border-radius: 12px;
            margin: 16px 0;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .search-bar input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 15px;
            margin-left: 8px;
        }

        /* Category Tabs */
        .category-tabs {
            display: flex;
            gap: 8px;
            padding: 0 16px 16px;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .category-tabs::-webkit-scrollbar {
            display: none;
        }

        .category-tab {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: white;
            color: var(--text-secondary);
        }

        .category-tab.active {
            background: var(--primary);
            color: white;
        }

        .category-tab[data-category="school_selection"] { border: 1px solid var(--school-selection); color: var(--school-selection); }
        .category-tab[data-category="school_selection"].active { background: var(--school-selection); color: white; }
        .category-tab[data-category="interview_prep"] { border: 1px solid var(--interview-prep); color: var(--interview-prep); }
        .category-tab[data-category="interview_prep"].active { background: var(--interview-prep); color: white; }
        .category-tab[data-category="experience"] { border: 1px solid var(--experience); color: var(--experience); }
        .category-tab[data-category="experience"].active { background: var(--experience); color: white; }

        /* Content Tabs */
        .content-tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            margin: 0 16px 16px;
            padding: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .content-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .content-tab.active {
            background: var(--primary);
            color: white;
        }

        /* List Container */
        .list-container {
            padding: 0 16px;
        }

        /* Question Card */
        .question-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .question-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .question-card .category-tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .category-tag.school_selection { background: rgba(59, 130, 246, 0.1); color: var(--school-selection); }
        .category-tag.interview_prep { background: rgba(139, 92, 246, 0.1); color: var(--interview-prep); }
        .category-tag.experience { background: rgba(34, 197, 94, 0.1); color: var(--experience); }
        .category-tag.other { background: rgba(107, 114, 128, 0.1); color: var(--other); }

        .question-card h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .question-card .preview {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .question-card .meta {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-top: 12px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .question-card .meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .question-card .resolved-badge {
            background: var(--success);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
        }

        /* Post Card */
        .post-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .post-card .cover-image {
            width: 100%;
            height: 160px;
            object-fit: cover;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .post-card .content {
            padding: 16px;
        }

        .post-card h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .post-card .tags {
            display: flex;
            gap: 6px;
            margin-bottom: 8px;
        }

        .post-card .tag {
            padding: 2px 8px;
            background: rgba(30, 148, 246, 0.1);
            color: var(--primary);
            border-radius: 8px;
            font-size: 12px;
        }

        .post-card .meta {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-top: 12px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Case Card */
        .case-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .case-card .school-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
        }

        .case-card .school-type {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(139, 92, 246, 0.1);
            color: var(--secondary);
            border-radius: 12px;
            font-size: 12px;
            margin-bottom: 12px;
        }

        .case-card .rating {
            display: flex;
            gap: 2px;
            margin-bottom: 8px;
        }

        .case-card .rating .star {
            color: #FFD700;
        }

        .case-card .rating .star.empty {
            color: #E5E7EB;
        }

        .case-card .questions-preview {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .case-card .meta {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(30, 148, 246, 0.4);
            cursor: pointer;
            z-index: 90;
            transition: transform 0.2s;
        }

        .fab:hover {
            transform: scale(1.1);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #E5E7EB;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 18px;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--text);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            font-size: 15px;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            border-color: var(--primary);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            width: 100%;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #1583dc;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--text);
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid #E5E7EB;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 12px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            z-index: 100;
        }

        .bottom-nav .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-secondary);
            padding: 8px 16px;
            transition: color 0.2s;
        }

        .bottom-nav .nav-item.active {
            color: var(--primary);
        }

        .bottom-nav .nav-item span:first-child {
            font-size: 24px;
        }

        .bottom-nav .nav-item span:last-child {
            font-size: 12px;
            margin-top: 2px;
        }

        /* Section Title */
        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin: 20px 16px 12px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>å®¶é•¿åä½œç©ºé—´</h1>
        <p>ä¸ä¸‡åƒå®¶é•¿äº¤æµæ‹©æ ¡ä¸é¢è¯•ç»éªŒ</p>
    </div>

    <!-- Quick Actions -->
    <div style="display: flex; gap: 8px; padding: 12px 16px; overflow-x: auto;">
        <div onclick="window.location.href='/parent-interview'" style="flex: 1; min-width: 140px; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); border-radius: 12px; padding: 12px; color: white; cursor: pointer;">
            <div style="font-size: 20px; margin-bottom: 4px;">ğŸ¤</div>
            <div style="font-size: 13px; font-weight: 600;">AIå®¶é•¿é¢è¯•</div>
            <div style="font-size: 11px; opacity: 0.9;">æ¨¡æ‹Ÿé¢è¯•ç»ƒä¹ </div>
        </div>
        <div onclick="window.location.href='/parent-coach'" style="flex: 1; min-width: 140px; background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%); border-radius: 12px; padding: 12px; color: white; cursor: pointer;">
            <div style="font-size: 20px; margin-bottom: 4px;">ğŸ§‘â€ğŸ«</div>
            <div style="font-size: 13px; font-weight: 600;">é¢è¯•æ•™ç»ƒ</div>
            <div style="font-size: 11px; opacity: 0.9;">å­¦ä¹ å¼•å¯¼æŠ€å·§</div>
        </div>
        <div onclick="window.location.href='/parent-notes'" style="flex: 1; min-width: 140px; background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); border-radius: 12px; padding: 12px; color: white; cursor: pointer;">
            <div style="font-size: 20px; margin-bottom: 4px;">ğŸ“</div>
            <div style="font-size: 13px; font-weight: 600;">å®¶é•¿ç¬”è®°</div>
            <div style="font-size: 11px; opacity: 0.9;">è®°å½•å­©å­æˆé•¿</div>
        </div>
    </div>

    <!-- Search Bar -->
    <div class="search-bar">
        <span class="material-symbols-outlined" style="color: var(--text-secondary);">search</span>
        <input type="text" id="searchInput" placeholder="æœç´¢é—®é¢˜ã€ç»éªŒã€æ¡ˆä¾‹...">
    </div>

    <!-- Category Tabs (for questions) -->
    <div class="category-tabs" id="categoryTabs">
        <button class="category-tab active" data-category="">å…¨éƒ¨</button>
        <button class="category-tab" data-category="school_selection">é€‰æ ¡</button>
        <button class="category-tab" data-category="interview_prep">é¢è¯•å‡†å¤‡</button>
        <button class="category-tab" data-category="experience">ç»éªŒåˆ†äº«</button>
        <button class="category-tab" data-category="other">å…¶ä»–</button>
    </div>

    <!-- Content Tabs -->
    <div class="content-tabs">
        <div class="content-tab active" data-tab="questions">é—®ç­”ç¤¾åŒº</div>
        <div class="content-tab" data-tab="experiences">ç»éªŒåˆ†äº«</div>
        <div class="content-tab" data-tab="cases">é¢è¯•æ¡ˆä¾‹</div>
    </div>

    <!-- Questions List -->
    <div class="list-container" id="questionsList">
        <div class="loading">
            <div class="spinner"></div>
            <p>åŠ è½½ä¸­...</p>
        </div>
    </div>

    <!-- Experiences List -->
    <div class="list-container" id="experiencesList" style="display: none;">
        <div class="loading">
            <div class="spinner"></div>
            <p>åŠ è½½ä¸­...</p>
        </div>
    </div>

    <!-- Cases List -->
    <div class="list-container" id="casesList" style="display: none;">
        <div class="loading">
            <div class="spinner"></div>
            <p>åŠ è½½ä¸­...</p>
        </div>
    </div>

    <!-- Floating Action Button -->
    <div class="fab" id="fabBtn">
        <span class="material-symbols-outlined">add</span>
    </div>

    <!-- Create Question Modal -->
    <div class="modal" id="questionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>æé—®</h2>
                <button class="modal-close" onclick="closeModal('questionModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>åˆ†ç±»</label>
                    <select id="questionCategory">
                        <option value="school_selection">é€‰æ ¡å’¨è¯¢</option>
                        <option value="interview_prep">é¢è¯•å‡†å¤‡</option>
                        <option value="experience">ç»éªŒåˆ†äº«</option>
                        <option value="other">å…¶ä»–</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>é—®é¢˜æ ‡é¢˜</label>
                    <input type="text" id="questionTitle" placeholder="ç®€è¦æè¿°ä½ çš„é—®é¢˜" maxlength="100">
                </div>
                <div class="form-group">
                    <label>è¯¦ç»†æè¿°</label>
                    <textarea id="questionContent" placeholder="è¯¦ç»†æè¿°ä½ çš„é—®é¢˜ï¼Œæœ‰åŠ©äºè·å¾—æ›´å¥½çš„å›ç­”" minlength="20"></textarea>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="questionAnonymous" style="width: auto;">
                        åŒ¿åå‘å¸ƒ
                    </label>
                </div>
                <button class="btn btn-primary" onclick="submitQuestion()">å‘å¸ƒé—®é¢˜</button>
            </div>
        </div>
    </div>

    <!-- Create Post Modal -->
    <div class="modal" id="postModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>åˆ†äº«ç»éªŒ</h2>
                <button class="modal-close" onclick="closeModal('postModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>æ ‡é¢˜</label>
                    <input type="text" id="postTitle" placeholder="ç»éªŒåˆ†äº«æ ‡é¢˜" maxlength="100">
                </div>
                <div class="form-group">
                    <label>å†…å®¹</label>
                    <textarea id="postContent" placeholder="åˆ†äº«ä½ çš„é¢è¯•å‡†å¤‡ç»éªŒã€æ‹©æ ¡å¿ƒå¾—..." style="min-height: 200px;"></textarea>
                </div>
                <div class="form-group">
                    <label>æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
                    <input type="text" id="postTags" placeholder="å¦‚: é¢è¯•æŠ€å·§, ç»éªŒåˆ†äº«">
                </div>
                <button class="btn btn-primary" onclick="submitPost()">å‘å¸ƒç»éªŒ</button>
            </div>
        </div>
    </div>

    <!-- Create Case Modal -->
    <div class="modal" id="caseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>åˆ†äº«é¢è¯•æ¡ˆä¾‹</h2>
                <button class="modal-close" onclick="closeModal('caseModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>å­¦æ ¡åç§°</label>
                    <input type="text" id="caseSchool" placeholder="å¦‚: DBS, SPCC">
                </div>
                <div class="form-group">
                    <label>å­¦æ ¡ç±»å‹</label>
                    <select id="caseType">
                        <option value="academic">å­¦æœ¯å‹</option>
                        <option value="holistic">å…¨äººå‹</option>
                        <option value="international">å›½é™…å‹</option>
                        <option value="traditional">ä¼ ç»Ÿåæ ¡</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>é¢è¯•æ—¥æœŸ</label>
                    <input type="date" id="caseDate">
                </div>
                <div class="form-group">
                    <label>é¢è¯•é—®é¢˜ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                    <textarea id="caseQuestions" placeholder="ä½ å«ä»€ä¹ˆåå­—ï¼Ÿ&#10;ä½ å–œæ¬¢ä»€ä¹ˆåŠ¨ç‰©ï¼Ÿ"></textarea>
                </div>
                <div class="form-group">
                    <label>é¢è¯•è€ƒå¯Ÿé‡ç‚¹</label>
                    <input type="text" id="caseKeyPoints" placeholder="å¦‚: è¡¨è¾¾èƒ½åŠ›, é€»è¾‘æ€ç»´">
                </div>
                <div class="form-group">
                    <label>æ•´ä½“è¯„åˆ† (1-5)</label>
                    <select id="caseRating">
                        <option value="5">5æ˜Ÿ - éå¸¸æ»¡æ„</option>
                        <option value="4">4æ˜Ÿ - æ»¡æ„</option>
                        <option value="3">3æ˜Ÿ - ä¸€èˆ¬</option>
                        <option value="2">2æ˜Ÿ - ä¸æ»¡æ„</option>
                        <option value="1">1æ˜Ÿ - éå¸¸ä¸æ»¡æ„</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>è¯¦ç»†è¯„ä»·</label>
                    <textarea id="caseReview" placeholder="åˆ†äº«é¢è¯•çš„æ•´ä½“æ„Ÿå—å’Œå»ºè®®ï¼ˆè‡³å°‘50å­—ï¼‰"></textarea>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="caseAnonymous" checked style="width: auto;">
                        åŒ¿åå‘å¸ƒ
                    </label>
                </div>
                <button class="btn btn-primary" onclick="submitCase()">æäº¤æ¡ˆä¾‹</button>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="{{ url_for('dashboard') }}" class="nav-item">
            <span class="material-symbols-outlined">home</span>
            <span>ä¸»é¡µ</span>
        </a>
        <a href="#" class="nav-item active">
            <span class="material-symbols-outlined">forum</span>
            <span>ç¤¾ç¾¤</span>
        </a>
        <a href="{{ url_for('practice_center') }}" class="nav-item">
            <span class="material-symbols-outlined">school</span>
            <span>ç»ƒä¹ </span>
        </a>
        <a href="{{ url_for('reports_page') }}" class="nav-item">
            <span class="material-symbols-outlined">assessment</span>
            <span>æŠ¥å‘Š</span>
        </a>
    </nav>

    <script>
        let currentTab = 'questions';
        let currentCategory = '';
        let currentPage = 1;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadQuestions();

            // Content Tab Click
            document.querySelectorAll('.content-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.content-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentTab = this.dataset.tab;
                    showCurrentTab();
                });
            });

            // Category Tab Click
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentCategory = this.dataset.category;
                    loadQuestions();
                });
            });

            // Search
            document.getElementById('searchInput').addEventListener('input', debounce(function(e) {
                loadQuestions();
            }, 500));

            // FAB Click
            document.getElementById('fabBtn').addEventListener('click', function() {
                if (currentTab === 'questions') {
                    openModal('questionModal');
                } else if (currentTab === 'experiences') {
                    openModal('postModal');
                } else if (currentTab === 'cases') {
                    openModal('caseModal');
                }
            });
        });

        function showCurrentTab() {
            document.getElementById('questionsList').style.display = currentTab === 'questions' ? 'block' : 'none';
            document.getElementById('experiencesList').style.display = currentTab === 'experiences' ? 'block' : 'none';
            document.getElementById('casesList').style.display = currentTab === 'cases' ? 'block' : 'none';
            document.getElementById('categoryTabs').style.display = currentTab === 'questions' ? 'flex' : 'none';

            if (currentTab === 'questions') loadQuestions();
            else if (currentTab === 'experiences') loadExperiences();
            else if (currentTab === 'cases') loadCases();
        }

        function loadQuestions() {
            const container = document.getElementById('questionsList');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>';

            const keyword = document.getElementById('searchInput').value;
            let url = '/api/community/questions?page=1&limit=20';
            if (currentCategory) url += `&category=${currentCategory}`;
            if (keyword) url += `&keyword=${encodeURIComponent(keyword)}`;

            fetch(url)
                .then(res => res.json())
                .then(data => {
                    if (data.questions && data.questions.length > 0) {
                        container.innerHTML = data.questions.map(q => `
                            <div class="question-card" onclick="viewQuestion(${q.id})">
                                <span class="category-tag ${q.category}">${getCategoryLabel(q.category)}</span>
                                <h3>${escapeHtml(q.title)}</h3>
                                <p class="preview">${escapeHtml(q.content.substring(0, 100))}</p>
                                <div class="meta">
                                    <span class="meta-item">
                                        <span class="material-symbols-outlined" style="font-size: 16px;">chat_bubble</span>
                                        ${q.answer_count} å›ç­”
                                    </span>
                                    <span class="meta-item">
                                        <span class="material-symbols-outlined" style="font-size: 16px;">visibility</span>
                                        ${q.view_count} æµè§ˆ
                                    </span>
                                    ${q.is_resolved ? '<span class="resolved-badge">å·²è§£å†³</span>' : ''}
                                </div>
                            </div>
                        `).join('');
                    } else {
                        container.innerHTML = `
                            <div class="empty-state">
                                <div class="icon">forum</div>
                                <h3>æš‚æ— é—®é¢˜</h3>
                                <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å‘å¸ƒç¬¬ä¸€ä¸ªé—®é¢˜</p>
                            </div>
                        `;
                    }
                })
                .catch(err => {
                    container.innerHTML = '<div class="empty-state"><p>åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</p></div>';
                });
        }

        function loadExperiences() {
            const container = document.getElementById('experiencesList');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>';

            const keyword = document.getElementById('searchInput').value;
            let url = '/api/community/experiences?page=1&limit=20';
            if (keyword) url += `&keyword=${encodeURIComponent(keyword)}`;

            fetch(url)
                .then(res => res.json())
                .then(data => {
                    if (data.posts && data.posts.length > 0) {
                        container.innerHTML = data.posts.map(p => `
                            <div class="post-card">
                                ${p.cover_image ? `<img class="cover-image" src="${p.cover_image}" alt="">` : ''}
                                <div class="content">
                                    <h3>${escapeHtml(p.title)}</h3>
                                    ${p.tags ? `<div class="tags">${p.tags.split(',').map(t => `<span class="tag">${escapeHtml(t.trim())}</span>`).join('')}</div>` : ''}
                                    <p class="preview">${escapeHtml(p.content.substring(0, 100))}</p>
                                    <div class="meta">
                                        <span class="meta-item">
                                            <span class="material-symbols-outlined" style="font-size: 16px;">thumb_up</span>
                                            ${p.like_count}
                                        </span>
                                        <span class="meta-item">
                                            <span class="material-symbols-outlined" style="font-size: 16px;">chat_bubble</span>
                                            ${p.comment_count}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        container.innerHTML = `
                            <div class="empty-state">
                                <div class="icon">article</div>
                                <h3>æš‚æ— ç»éªŒåˆ†äº«</h3>
                                <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åˆ†äº«ä½ çš„ç»éªŒ</p>
                            </div>
                        `;
                    }
                })
                .catch(err => {
                    container.innerHTML = '<div class="empty-state"><p>åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</p></div>';
                });
        }

        function loadCases() {
            const container = document.getElementById('casesList');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>';

            const keyword = document.getElementById('searchInput').value;
            let url = '/api/community/cases?page=1&limit=20';
            if (keyword) url += `&school_name=${encodeURIComponent(keyword)}`;

            fetch(url)
                .then(res => res.json())
                .then(data => {
                    if (data.cases && data.cases.length > 0) {
                        container.innerHTML = data.cases.map(c => `
                            <div class="case-card">
                                <div class="school-name">${escapeHtml(c.school_name)}</div>
                                <span class="school-type">${getSchoolTypeLabel(c.school_type)}</span>
                                <div class="rating">
                                    ${[1,2,3,4,5].map(i => `<span class="material-symbols-outlined star ${i <= c.overall_rating ? '' : 'empty'}">star</span>`).join('')}
                                </div>
                                <p class="questions-preview">${c.questions_preview ? c.questions_preview.join(' / ') : ''}</p>
                                <div class="meta">
                                    <span>${c.interview_date}</span>
                                    <span>${c.helpful_count} äººè®¤ä¸ºæœ‰å¸®åŠ©</span>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        container.innerHTML = `
                            <div class="empty-state">
                                <div class="icon">school</div>
                                <h3>æš‚æ— é¢è¯•æ¡ˆä¾‹</h3>
                                <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åˆ†äº«é¢è¯•ç»å†</p>
                            </div>
                        `;
                    }
                })
                .catch(err => {
                    container.innerHTML = '<div class="empty-state"><p>åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</p></div>';
                });
        }

        function viewQuestion(id) {
            // For now, just log - would navigate to detail page
            console.log('View question:', id);
        }

        function getCategoryLabel(category) {
            const labels = {
                'school_selection': 'é€‰æ ¡',
                'interview_prep': 'é¢è¯•å‡†å¤‡',
                'experience': 'ç»éªŒåˆ†äº«',
                'other': 'å…¶ä»–'
            };
            return labels[category] || category;
        }

        function getSchoolTypeLabel(type) {
            const labels = {
                'academic': 'å­¦æœ¯å‹',
                'holistic': 'å…¨äººå‹',
                'international': 'å›½é™…å‹',
                'traditional': 'ä¼ ç»Ÿåæ ¡'
            };
            return labels[type] || type;
        }

        function openModal(id) {
            document.getElementById(id).classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function submitQuestion() {
            const category = document.getElementById('questionCategory').value;
            const title = document.getElementById('questionTitle').value;
            const content = document.getElementById('questionContent').value;
            const isAnonymous = document.getElementById('questionAnonymous').checked;

            if (!title || !content) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }

            fetch('/api/community/questions', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({category, title, content, is_anonymous: isAnonymous})
            })
            .then(res => res.json())
            .then(data => {
                if (data.id) {
                    closeModal('questionModal');
                    loadQuestions();
                    document.getElementById('questionTitle').value = '';
                    document.getElementById('questionContent').value = '';
                } else {
                    alert(data.error || 'å‘å¸ƒå¤±è´¥');
                }
            });
        }

        function submitPost() {
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const tagsStr = document.getElementById('postTags').value;
            const tags = tagsStr ? tagsStr.split(',').map(t => t.trim()) : [];

            if (!title || !content) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }

            fetch('/api/community/experiences', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({title, content, tags})
            })
            .then(res => res.json())
            .then(data => {
                if (data.id) {
                    closeModal('postModal');
                    loadExperiences();
                    document.getElementById('postTitle').value = '';
                    document.getElementById('postContent').value = '';
                    document.getElementById('postTags').value = '';
                } else {
                    alert(data.error || 'å‘å¸ƒå¤±è´¥');
                }
            });
        }

        function submitCase() {
            const school_name = document.getElementById('caseSchool').value;
            const school_type = document.getElementById('caseType').value;
            const interview_date = document.getElementById('caseDate').value;
            const questionsText = document.getElementById('caseQuestions').value;
            const key_points = document.getElementById('caseKeyPoints').value;
            const overall_rating = parseInt(document.getElementById('caseRating').value);
            const review_content = document.getElementById('caseReview').value;
            const isAnonymous = document.getElementById('caseAnonymous').checked;

            if (!school_name || !interview_date || !questionsText || !review_content) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }

            const questions = questionsText.split('\n').filter(q => q.trim()).map(q => ({
                question: q.trim(),
                feedback: ''
            }));

            fetch('/api/community/cases', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    school_name,
                    school_type,
                    interview_date,
                    questions,
                    key_points,
                    overall_rating,
                    review_content,
                    is_anonymous: isAnonymous
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.id) {
                    closeModal('caseModal');
                    alert('æ¡ˆä¾‹å·²æäº¤ï¼Œå¾…å®¡æ ¸åå‘å¸ƒ');
                    loadCases();
                    document.getElementById('caseSchool').value = '';
                    document.getElementById('caseQuestions').value = '';
                    document.getElementById('caseReview').value = '';
                } else {
                    alert(data.error || 'æäº¤å¤±è´¥');
                }
            });
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>
