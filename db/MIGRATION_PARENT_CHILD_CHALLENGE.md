# äº²å­å…±é¢æŒ‘æˆ˜åŠŸèƒ½ - æ•°æ®åº“è¿ç§»æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°
äº²å­å…±é¢æŒ‘æˆ˜åŠŸèƒ½åŒ…å«ä»¥ä¸‹æ ¸å¿ƒæ¨¡å—ï¼š
- **åŒäººåä½œé¢è¯•æ¨¡å¼**: å®¶é•¿å’Œå­©å­åˆ†åˆ«å›ç­”åŒä¸€é—®é¢˜
- **AI å¯¹æ¯”åˆ†æ**: ç”Ÿæˆã€Œé»˜å¥‘åº¦è¯„åˆ†ã€å’ŒåŒæ–¹ç­”æ¡ˆå¯¹æ¯”
- **å®¶é•¿ç‰ˆç­”æ¡ˆä¼˜åŒ–å»ºè®®**: å¸®åŠ©å®¶é•¿æˆä¸ºæ›´å¥½æ•™ç»ƒ
- **äº²å­ PK æ¦œå•**: å±•ç¤ºå®¶åº­åä½œæˆç»©
- **åˆä½œå‹‹ç« ä½“ç³»**: å®ŒæˆæŒ‘æˆ˜è·å¾—ç‰¹æ®Šå‹‹ç« 

## æ•°æ®åº“è¿ç§»æ­¥éª¤

### æ–¹æ³•ä¸€ï¼šç›´æ¥è¿è¡Œ SQL è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# 1. è¿æ¥åˆ°æ•°æ®åº“
psql $DATABASE_URL

# 2. è¿è¡Œè¿ç§»è„šæœ¬
\i db/parent_child_challenge_tables.sql

# 3. éªŒè¯è¡¨åˆ›å»º
\dt parent_child_*
\dt challenge_*
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨ pgAdmin æˆ–å…¶ä»– GUI å·¥å…·

1. è¿æ¥åˆ° PostgreSQL æ•°æ®åº“
2. æ‰“å¼€ Query Tool
3. å¤åˆ¶å¹¶æ‰§è¡Œ `db/parent_child_challenge_tables.sql` æ–‡ä»¶å†…å®¹

## åˆ›å»ºçš„æ•°æ®åº“è¡¨

### 1. parent_child_challenges
äº²å­æŒ‘æˆ˜è®°å½•è¡¨
- å­˜å‚¨æ¯æ¬¡æŒ‘æˆ˜çš„åŸºæœ¬ä¿¡æ¯
- è®°å½•å®¶é•¿å’Œå­©å­çš„ç­”æ¡ˆ
- è·Ÿè¸ªæŒ‘æˆ˜çŠ¶æ€

### 2. challenge_scores
é»˜å¥‘åº¦è¯„åˆ†è¡¨
- å­˜å‚¨ AI ç”Ÿæˆçš„é»˜å¥‘åº¦è¯„åˆ†
- åŒ…å«è¯¦ç»†è¯„åˆ†ç»´åº¦ï¼ˆç›¸ä¼¼åº¦ã€åä½œåº¦ã€æ²Ÿé€šè´¨é‡ã€åˆ›æ„è¡¨ç°ï¼‰
- è®°å½• AI åˆ†æç»“æœå’Œå®¶é•¿ä¼˜åŒ–å»ºè®®

### 3. challenge_leaderboard
äº²å­ PK æ¦œå•è¡¨
- ç»Ÿè®¡ç”¨æˆ·æŒ‘æˆ˜æˆç»©
- æ”¯æŒå‘¨æ’åã€æœˆæ’åã€æ€»æ’å
- è‡ªåŠ¨æ›´æ–°ï¼ˆé€šè¿‡è§¦å‘å™¨ï¼‰

### 4. challenge_badges
åˆä½œå‹‹ç« å®šä¹‰è¡¨
- å­˜å‚¨å‹‹ç« é…ç½®
- åŒ…å«å‹‹ç« è·å–æ¡ä»¶

### 5. user_challenge_badges
ç”¨æˆ·åˆä½œå‹‹ç« è¡¨
- è®°å½•ç”¨æˆ·è·å¾—çš„å‹‹ç« 
- è·Ÿè¸ªå‹‹ç« è·å–è¿›åº¦

## åˆå§‹æ•°æ®

è„šæœ¬ä¼šè‡ªåŠ¨æ’å…¥ä»¥ä¸‹åˆä½œå‹‹ç« å®šä¹‰ï¼š
- ğŸ¤ ç¬¬ä¸€æ¬¡åˆä½œï¼ˆå®Œæˆ 1 æ¬¡æŒ‘æˆ˜ï¼‰
- ğŸ‘« åä½œå°èƒ½æ‰‹ï¼ˆå®Œæˆ 5 æ¬¡æŒ‘æˆ˜ï¼‰
- ğŸ’¯ å®Œç¾æ­æ¡£ï¼ˆè·å¾—é«˜é»˜å¥‘åº¦ï¼‰
- ğŸ’¬ æ²Ÿé€šå°è¾¾äººï¼ˆæ²Ÿé€šç»´åº¦ 80+ï¼‰
- ğŸ“– æ•…äº‹å¤§å¸ˆï¼ˆåˆ›æ„ç»´åº¦ 90+ï¼‰
- ğŸ† é€±å† å†›ï¼ˆä¸€å‘¨å®Œæˆ 7 æ¬¡ï¼‰
- ğŸ‘‘ æœˆå† å†›ï¼ˆä¸€æœˆå®Œæˆ 30 æ¬¡ï¼‰
- â­ é»˜å¥‘å¤§å¸ˆï¼ˆç´¯è®¡é»˜å¥‘åº¦ 500 åˆ†ï¼‰

## è‡ªåŠ¨æ›´æ–°æœºåˆ¶

æ•°æ®åº“è§¦å‘å™¨ä¼šè‡ªåŠ¨æ›´æ–°æ’è¡Œæ¦œï¼š
- `trigger_update_leaderboard_after_challenge`: æŒ‘æˆ˜è®°å½•å˜åŒ–æ—¶
- `trigger_update_leaderboard_after_score`: è¯„åˆ†è®°å½•å˜åŒ–æ—¶

## éªŒè¯å®‰è£…

è¿è¡Œä»¥ä¸‹æŸ¥è¯¢éªŒè¯è¡¨åˆ›å»ºæˆåŠŸï¼š

```sql
-- æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
  AND table_name LIKE 'parent_child%' 
   OR table_name LIKE 'challenge_%';

-- æ£€æŸ¥å‹‹ç« å®šä¹‰
SELECT id, name_zh, icon_emoji, requirement_type 
FROM challenge_badges;

-- æ£€æŸ¥è§¦å‘å™¨
SELECT trigger_name, event_manipulation, event_object_table
FROM information_schema.triggers
WHERE trigger_schema = 'public'
  AND trigger_name LIKE '%leaderboard%';
```

## ç¯å¢ƒå˜é‡è¦æ±‚

ç¡®ä¿ä»¥ä¸‹ç¯å¢ƒå˜é‡å·²é…ç½®ï¼š
- `DATABASE_URL`: PostgreSQL æ•°æ®åº“è¿æ¥ URL
- `MINIMAX_API_KEY`: MiniMax API å¯†é’¥ï¼ˆç”¨äº AI åˆ†æï¼‰
- `MINIMAX_BASE_URL`: MiniMax API åŸºç¡€ URLï¼ˆé»˜è®¤ï¼šhttps://api.minimax.chat/v1ï¼‰

## æ•…éšœæ’é™¤

### é—®é¢˜ï¼šè¡¨åˆ›å»ºå¤±è´¥
**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥æ•°æ®åº“ç”¨æˆ·æƒé™ï¼Œç¡®ä¿æœ‰ CREATE TABLE æƒé™

### é—®é¢˜ï¼šè§¦å‘å™¨åˆ›å»ºå¤±è´¥
**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥æ•°æ®åº“ç”¨æˆ·æ˜¯å¦æœ‰ CREATE TRIGGER æƒé™

### é—®é¢˜ï¼šJSONB ç±»å‹ä¸æ”¯æŒ
**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿ PostgreSQL ç‰ˆæœ¬ >= 9.4

## API ç«¯ç‚¹

åˆ›å»ºå®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ç«¯ç‚¹æµ‹è¯•åŠŸèƒ½ï¼š

- `GET /parent-child-challenge`: æŒ‘æˆ˜é¡µé¢
- `POST /api/parent-child-challenge/start`: å¼€å§‹æŒ‘æˆ˜
- `POST /api/parent-child-challenge/submit`: æäº¤ç­”æ¡ˆ
- `GET /api/parent-child-challenge/leaderboard`: æŸ¥çœ‹æ’è¡Œæ¦œ
- `GET /api/parent-child-challenge/badges`: æŸ¥çœ‹å‹‹ç« 

## ä¸‹ä¸€æ­¥

1. è¿è¡Œæ•°æ®åº“è¿ç§»
2. æµ‹è¯•åŠŸèƒ½ï¼šè®¿é—® https://app-cs6e.onrender.com/parent-child-challenge
3. æäº¤ä»£ç åˆ° GitHub
